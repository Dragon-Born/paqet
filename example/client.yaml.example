# paqet Client Configuration Example
#
# Features:
# - Network auto-detection: Use `network: {}` to auto-detect interface, IP, and gateway MAC
# - Auto-reconnect: Client automatically reconnects on network changes (WiFi switch, sleep/wake)
# - Health checks: Connections are tested every 30 seconds
#
# Role must be explicitly set
role: "client"

# Logging configuration
log:
  level: "info"  # none, debug, info, warn, error, fatal

# SOCKS5 proxy configuration (client mode)
socks5:
  - listen: "127.0.0.1:1080"    # SOCKS5 proxy listen address
    username: ""                # Optional SOCKS5 authentication
    password: ""                # Optional SOCKS5 authentication

# Alternative: Port forwarding configuration (instead of SOCKS5)
# forward:
#   - listen: "127.0.0.1:8080"  # Local port to listen on
#     target: "127.0.0.1:80"    # Target to forward to (via server)
#     protocol: "tcp"           # Protocol (tcp/udp)
#     streams: 8                # UDP only: parallel streams for throughput (1-64, default: 8)

# TUN mode (full system VPN - routes all traffic through tunnel)
# Requires root/administrator privileges
# tun:
#   name: "paqet0"           # TUN device name (default: "utun" on macOS, "paqet0" on Linux/Windows)
#   addr: "10.0.85.1/24"     # TUN interface address (CIDR)
#   mtu: 1400                # TUN MTU (default: 1400, smaller than Ethernet to avoid fragmentation)
#   dns: "8.8.8.8"           # DNS server
#   auto_route: true         # Auto-configure system routes
#   exclude:                 # IPs/CIDRs routed through original gateway (bypass tunnel)
#     - "203.0.113.50"       # e.g., your SSH source IP (bare IP becomes /32)
#     - "198.51.100.0/24"    # e.g., office subnet

# Network interface settings
#
# AUTO-DETECTION: Use `network: {}` to auto-detect all settings.
# paqet will detect interface, local IP, and gateway MAC automatically.
# This works on macOS, Linux, and Windows.
#
# Minimal config example with auto-detection:
#   role: "client"
#   network: {}
#   server:
#     addr: "10.0.0.100:9999"
#   transport:
#     protocol: "kcp"
#     kcp:
#       key: "your-secret-key-here"
#
# You can also partially specify settings - missing fields are auto-detected:
#   network:
#     interface: "en0"    # Manually set interface
#     ipv4:               # IP and MAC will be auto-detected
#
network:
  interface: "en0"                          # CHANGE ME: Network interface (en0, eth0, wlan0, etc.)
  # guid: "\Device\NPF_{...}"               # Windows only (Npcap).

  # IPv4 configuration
  ipv4:
    addr: "192.168.1.100:0"                 # CHANGE ME: Local IP (use port 0 for random port)
    router_mac: "aa:bb:cc:dd:ee:ff"         # CHANGE ME: Gateway/router MAC address

  # IPv6 configuration (optional)
  ipv6:
    addr: "[2001:db8::1]:0"                 # CHANGE ME: Local IPv6 address and port (optional)
    router_mac: "aa:bb:cc:dd:ee:ff"         # CHANGE ME: Gateway/router MAC address for IPv6

  tcp:
    local_flag: ["PA"]                      # Local TCP flags (Push+Ack default)
    remote_flag: ["PA"]                     # Remote TCP flags (Push+Ack default)

  # PCAP settings (optional - will use defaults)
  # pcap:
    # sockbuf: 4194304                        # 4MB buffer (default for client)

# Server connection settings
server:
  addr: "10.0.0.100:9999"  # CHANGE ME: paqet server address and port

# Transport protocol configuration
transport:
  protocol: "kcp"  # Transport protocol: "kcp", "quic", "udp", or "auto"
                   # "auto" mode: client probes all configured protocols
                   # and selects the one with lowest RTT.
                   # Requires at least 2 protocol sections configured.
                   # Server must also use "auto" to accept all protocols.
  conn: 4          # Number of connections (1-256, default: 4, power-of-2 recommended)

  # KCP protocol settings
  kcp:
    mode: "fast"            # KCP mode: normal, fast, fast2, fast3, manual

    # Manual mode parameters (only used when mode="manual")
    # nodelay: 1              # 0=disable, 1=enable
                              # Enable for lower latency & aggressive retransmission
                              # Disable for TCP-like conservative behavior

    # interval: 10            # Internal update timer interval in milliseconds (10-5000ms)
                              # Lower values increase responsiveness but raise CPU usage

    # resend: 2               # Fast retransmit trigger (0-2)
                              # 0 = disabled (wait for timeout)
                              # 1 = fast retransmit after 1 skipped ACK
                              # 2 = very fast retransmit after 2 skipped ACKs (recommended for lossy networks)

    # nocongestion: 1         # Congestion control: 0=enabled, 1=disabled
                              # 0 = TCP-like fair congestion control (slow start, congestion avoidance)
                              # 1 = disable congestion control for maximum speed

    # wdelay: false           # Write batching behavior
                              # false = flush immediately (low latency, recommended for real-time)
                              # true = batch writes until next update interval (higher throughput)
                              # Controls when data is actually sent to the network

    # acknodelay: true        # ACK sending behavior
                              # true = send ACKs immediately when packets are received (lower latency)
                              # false = batch ACKs (more bandwidth efficient)
                              # Setting true reduces latency but increases bandwidth usage

    # MTU calculation: Ethernet(1500) - IP header - TCP header+opts(32)
    #   IPv4: 1500 - 20 - 32 = 1448 (auto-optimized to 1440)
    #   IPv6: 1500 - 40 - 32 = 1428 (auto-optimized to 1420)
    #   Default 1400 is safe for dual-stack; auto-optimized if single IP version
    # mtu: 1400

    # Window sizes control max throughput: throughput = (window * MTU) / RTT
    #   2048 windows @ 1400 MTU @ 50ms RTT = ~56 Mbps
    #   4096 windows @ 1400 MTU @ 50ms RTT = ~112 Mbps
    # rcvwnd: 2048           # Receive window size (default: 2048)
    # sndwnd: 2048           # Send window size (default: 2048)

    # Encryption settings
    # block: "aes"                    # Encryption: aes, aes-128, aes-128-gcm, aes-192, salsa20, blowfish, twofish, cast5, 3des, tea, xtea, xor, sm4, none.
    key: "your-secret-key-here"       # CHANGE ME: Secret key (must match server)

    # Buffer settings for high-throughput
    # smuxbuf: 8388608       # 8MB session buffer (default)
    # streambuf: 4194304     # 4MB per-stream buffer (default)

# Optional Forward Error Correction (FEC) - currently disabled
# Use these only if you need FEC for very lossy networks:
#   dshard: 10    # Data shards for FEC
#   pshard: 3     # Parity shards for FEC

  # QUIC transport settings (used when protocol="quic")
  # quic:
  #   key: "your-secret-key-here"   # Shared secret for deterministic TLS cert (must match server)
  #   alpn: "h3"                    # ALPN protocol (default: "h3" to mimic HTTP/3)
  #   max_streams: 256              # Max concurrent streams (1-65535)
  #   idle_timeout: 30s             # Connection idle timeout (1s-5m)
  #   # cert_file: "cert.pem"      # Optional: custom TLS certificate
  #   # key_file: "key.pem"        # Optional: custom TLS private key

  # Raw UDP transport settings (used when protocol="udp")
  # WARNING: No reliability layer - packet loss causes stream errors
  # udp:
  #   key: "your-secret-key-here"   # Encryption key (must match server)
  #   block: "aes"                  # Encryption: aes, salsa20, none, etc.
  #   smuxbuf: 4194304              # 4MB smux buffer
  #   streambuf: 2097152            # 2MB stream buffer
